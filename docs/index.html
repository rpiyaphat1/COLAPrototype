<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (IEP Smart Assistant)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&family=Kanit:wght@300;400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #1e40af;
            --admin: #5b21b6;
            --bg: #f8fafc;
            --white: #ffffff;
            --border: #cbd5e1;
            --text-main: #1e293b;
            --text-label: #475569;
        }

        body {
            font-family: 'Sarabun', 'Kanit', sans-serif;
            margin: 0;
            background: var(--bg);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        nav {
            background: #0f172a;
            color: white;
            padding: 0.8rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }

        .nav-links button {
            background: transparent;
            border: 1px solid transparent;
            color: #94a3b8;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
            margin-left: 10px;
            font-family: 'Sarabun', sans-serif;
        }

        .nav-links button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .container {
            flex: 1;
            padding: 25px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .page {
            display: none;
            height: 100%;
            overflow-y: auto;
            padding-bottom: 40px;
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        .card {
            background: var(--white);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-bottom: 25px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-label);
            display: block;
            margin-bottom: 10px;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: 'Sarabun', sans-serif;
            font-size: 1rem;
            transition: all 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(30, 64, 175, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-admin {
            background: var(--admin);
            color: white;
        }

        .chat-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--white);
            border-radius: 20px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .messages {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            background: #f1f5f9;
        }

        .msg {
            margin-bottom: 15px;
            padding: 15px 20px;
            border-radius: 15px;
            max-width: 80%;
            line-height: 1.6;
        }

        .user-msg {
            background: #e2e8f0;
            color: #1e293b;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 2px;
        }

        .ai-msg {
            background: white;
            border: 1px solid #e2e8f0;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        .option-btn {
            background: #fff;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.9rem;
        }

        .footer {
            padding: 20px;
            display: flex;
            gap: 12px;
            background: white;
            border-top: 1px solid #e2e8f0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th,
        td {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
            text-align: left;
        }
    </style>
</head>

<body>

    <nav>
        <div style="font-weight: 500; font-size: 1.2rem;">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span style="color:#60a5fa">| IEP
                Assistant</span></div>
        <div class="nav-links">
            <button id="navChat" class="active" onclick="togglePage('chat')">‡∏™‡∏∑‡∏ö‡∏Ñ‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <button id="navAdmin" onclick="togglePage('admin')">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Admin)</button>
        </div>
    </nav>

    <div class="container">
        <div id="adminPage" class="page">
            <div class="card" style="border: 1px dashed var(--admin); text-align: center;">
                <h3>üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <input type="file" id="excelInput" accept=".xlsx, .csv" style="display:none"
                    onchange="importData(event)">
                <button class="btn btn-admin" onclick="document.getElementById('excelInput').click()">üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
                    Excel/CSV</button>
            </div>

            <div class="card">
                <h3 id="formTitle" style="color:var(--primary);">üë§ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <input type="hidden" id="editIndex" value="-1">
                <div class="grid">
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å/‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label><input type="text" id="inNick"></div>
                    <div class="form-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="inFull"></div>
                    <div class="form-group"><label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label><input type="text" id="inClass"
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ.1/1"></div>
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á</label>
                        <select id="inType">
                            <option value="0" selected>0. ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                            <option value="1">1. ‡πÄ‡∏´‡πá‡∏ô</option>
                            <option value="2">2. ‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô</option>
                            <option value="3">3. ‡∏™‡∏ï‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤</option>
                            <option value="4">4. ‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢</option>
                            <option value="5">5. ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (LD)</option>
                            <option value="6">6. ‡∏û‡∏π‡∏î/‡∏†‡∏≤‡∏©‡∏≤</option>
                            <option value="7">7. ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</option>
                            <option value="8">8. ‡∏≠‡∏≠‡∏ó‡∏¥‡∏™‡∏ï‡∏¥‡∏Å</option>
                            <option value="9">9. ‡∏û‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≠‡∏ô</option>
                        </select>
                    </div>
                </div>
                <div class="form-group"><label>‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</label><textarea id="inHandle" rows="3"></textarea>
                </div>
                <button class="btn btn-primary" style="width:100%" onclick="saveStudent()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>

            <div class="card">
                <h3>üìë ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (<span id="count">0</span>)</h3>
                <div style="overflow-x:auto;">
                    <table id="studentTable">
                        <thead>
                            <tr>
                                <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</th>
                                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á</th>
                                <th>‡∏ä‡∏±‡πâ‡∏ô</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="chatPage" class="page active">
            <div class="chat-view">
                <div class="messages" id="chatBox">
                    <div class="msg ai-msg"><strong>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö</strong><br>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏õ.1/1)
                        ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö</div>
                </div>
                <div class="footer">
                    <input type="text" id="chatInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô..."
                        onkeypress="if(event.key==='Enter') doSearch()">
                    <button class="btn btn-primary" onclick="doSearch()">üîç ‡∏™‡∏∑‡∏ö‡∏Ñ‡πâ‡∏ô</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const typeNames = { "0": "‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", "1": "‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏´‡πá‡∏ô", "2": "‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô", "3": "‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏™‡∏ï‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤", "4": "‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢/‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", "5": "‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ (LD)", "6": "‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î/‡∏†‡∏≤‡∏©‡∏≤", "7": "‡∏ö‡∏Å‡∏û‡∏£‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°/‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå", "8": "‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏≠‡∏≠‡∏ó‡∏¥‡∏™‡∏ï‡∏¥‡∏Å", "9": "‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏û‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≠‡∏ô" };
        const careInfo = { "0": "‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏õ‡∏Å‡∏ï‡∏¥", "1": "‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏°/‡πÄ‡∏™‡∏µ‡∏¢‡∏á", "2": "‡∏†‡∏≤‡∏û/‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå", "3": "‡∏¢‡πà‡∏≠‡∏¢‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤", "4": "‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û", "5": "‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°", "6": "‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏ü‡∏±‡∏á", "7": "‡πÅ‡∏£‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏ö‡∏ß‡∏Å", "8": "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏†‡∏≤‡∏û", "9": "‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï" };
        let db = [];

        function norm(txt) { return txt ? txt.toString().toLowerCase().replace(/[.\s\/-]/g, '').replace(/‡∏õ/g, '').trim() : ""; }
        function clean(v) { return (!v || v.toString().trim() === "" || v === "undefined") ? "-" : v.toString().trim(); }

        function togglePage(p) {
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-links button').forEach(el => el.classList.remove('active'));
            document.getElementById(p + 'Page').classList.add('active');
            document.getElementById('nav' + p.charAt(0).toUpperCase() + p.slice(1)).classList.add('active');
        }

        function importData(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function (e) {
                const workbook = XLSX.read(new Uint8Array(e.target.result), { type: 'array' });
                const json = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                json.forEach((item, idx) => {
                    let rawT = String(item["‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"] || "0");
                    db.push({
                        originalIdx: item["‡∏•‡∏≥‡∏î‡∏±‡∏ö"] || idx + 1,
                        nick: clean(item["‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô"] || item["‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å"]),
                        full: clean(item["‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"] || item["‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á"]),
                        class: clean(item["‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"]),
                        type: rawT.match(/\d+/) ? rawT.match(/\d+/)[0] : "0",
                        handle: clean(item["‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠"] || item["‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡πÄ‡∏â‡∏û‡∏≤‡∏∞"])
                    });
                });
                renderTable(); alert("‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            };
            reader.readAsArrayBuffer(file);
        }

        function saveStudent() {
            const idx = parseInt(document.getElementById('editIndex').value);
            const s = {
                originalIdx: idx === -1 ? db.length + 1 : db[idx].originalIdx,
                nick: clean(document.getElementById('inNick').value),
                full: clean(document.getElementById('inFull').value),
                class: clean(document.getElementById('inClass').value),
                type: document.getElementById('inType').value,
                handle: clean(document.getElementById('inHandle').value)
            };
            if (idx === -1) db.push(s); else db[idx] = s;
            resetForm(); renderTable(); alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }

        function renderTable() {
            document.getElementById('count').innerText = db.length;
            document.querySelector("#studentTable tbody").innerHTML = db.map((s, i) => `<tr><td>${s.originalIdx}</td><td>${s.nick}</td><td>${s.full}</td><td>${s.class}</td><td><button onclick="editStudent(${i})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></td></tr>`).join('');
        }

        function editStudent(i) {
            const s = db[i];
            document.getElementById('inNick').value = s.nick; document.getElementById('inFull').value = s.full;
            document.getElementById('inClass').value = s.class; document.getElementById('inType').value = s.type;
            document.getElementById('inHandle').value = s.handle === "-" ? "" : s.handle;
            document.getElementById('editIndex').value = i;
            togglePage('admin');
        }

        function resetForm() {
            document.getElementById('inNick').value = ""; document.getElementById('inFull').value = "";
            document.getElementById('inClass').value = ""; document.getElementById('inHandle').value = "";
            document.getElementById('inType').value = "0"; document.getElementById('editIndex').value = "-1";
        }

        function doSearch() {
            const val = document.getElementById('chatInput').value.trim();
            if (!val) return;
            addMsg(val, 'user-msg');
            document.getElementById('chatInput').value = "";

            setTimeout(() => {
                const target = norm(val);

                // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡πÄ‡∏õ‡πä‡∏∞‡πÜ
                let exactMatch = db.find(s => s.full === val);
                if (exactMatch) return addMsg(report(exactMatch), 'ai-msg');

                // 2. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô (‡∏õ.1/1)
                let classMatches = db.filter(s => norm(s.class) === target || (val.includes("/") && norm(s.class).includes(target)));
                if (classMatches.length > 0 && (val.includes("/") || target.length <= 4)) {
                    let btns = classMatches.map(s => `<button class="option-btn" onclick="setSearch('${s.full}')">${s.full} (${s.nick})</button>`).join('');
                    return addMsg(`‡∏û‡∏ö‡∏ô‡πâ‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡πâ‡∏≠‡∏á <strong>${val}</strong> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${classMatches.length} ‡∏ó‡πà‡∏≤‡∏ô:<br>${btns}`, 'ai-msg');
                }

                // 3. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
                let nameMatches = db.filter(s => norm(s.nick).includes(target) || target.includes(norm(s.nick)) || norm(s.full).includes(target));
                if (nameMatches.length === 1) return addMsg(report(nameMatches[0]), 'ai-msg');
                if (nameMatches.length > 1) {
                    let btns = nameMatches.map(s => `<button class="option-btn" onclick="setSearch('${s.full}')">${s.full} [${s.class}]</button>`).join('');
                    return addMsg(`‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ö <strong>"${val}"</strong> ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡∏ö:<br>${btns}`, 'ai-msg');
                }

                addMsg(`‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ "${val}" ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö`, 'ai-msg');
            }, 400);
        }

        function report(s) {
            return `üìä <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${s.full}</strong><br>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô: ${s.nick} | ‡∏ä‡∏±‡πâ‡∏ô: ${s.class}<br>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${typeNames[s.type]}<br><hr>‚úÖ ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á: ${careInfo[s.type]}<br>${s.handle !== "-" ? `üí° ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ: ${s.handle}` : ""}`;
        }

        function addMsg(t, c) {
            const box = document.getElementById('chatBox');
            const d = document.createElement('div'); d.className = `msg ${c}`; d.innerHTML = t;
            box.appendChild(d); box.scrollTop = box.scrollHeight;
        }

        window.setSearch = function (v) { document.getElementById('chatInput').value = v; doSearch(); }
    </script>
</body>

</html>